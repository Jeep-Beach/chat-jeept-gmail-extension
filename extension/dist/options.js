var h=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var p=h((f,o)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();let l=class{constructor(){this.syncKeys=["apiKey","tone","fallbackMessage","jeepBeachUrls","useGmailApi"]}async getSyncData(){return new Promise(e=>{chrome.storage.sync.get(this.syncKeys,t=>{e(t)})})}async setSyncData(e){return new Promise(t=>{chrome.storage.sync.set(e,()=>{t()})})}async getLocalData(e){return new Promise(t=>{chrome.storage.local.get(e,r=>{t(r)})})}async setLocalData(e){return new Promise(t=>{chrome.storage.local.set(e,()=>{t()})})}getDefaultSettings(){return{apiKey:"",tone:"friendly, concise, cheerful + helpful",fallbackMessage:`Thanks for reaching out! The fastest path is our FAQs: https://jeepbeach.com/faq/
If you still need help, just reply here and we'll jump in.`,jeepBeachUrls:["https://jeepbeach.com/","https://jeepbeach.com/faq/","https://jeepbeach.com/events/","https://jeepbeach.com/registration/"].join(`
`),useGmailApi:!1}}async initializeSettings(){const e=await this.getSyncData(),t=this.getDefaultSettings();if(this.syncKeys.some(s=>e[s]===void 0)){const s={...t,...e};return await this.setSyncData(s),s}return e}async getSiteCache(){return(await this.getLocalData(["jeepBeachCache"])).jeepBeachCache||null}async setSiteCache(e){const t={text:e,updatedAt:Date.now()};await this.setLocalData({jeepBeachCache:t})}isCacheExpired(e){if(!e||!e.updatedAt)return!0;const t=4*60*60*1e3;return Date.now()-e.updatedAt>t}};typeof o<"u"&&o.exports?o.exports=l:window.StorageManager=l;let u=class{constructor(e,t="openai"){this.apiKey=e,this.provider=t,this.baseUrl=this.getBaseUrl(t)}getBaseUrl(e){switch(e){case"openai":return"https://api.openai.com/v1";case"anthropic":return"https://api.anthropic.com/v1";default:return"https://api.openai.com/v1"}}async generateDraft(e,t,r,s){if(!this.apiKey)throw new Error("API key not configured");const a=this.buildSystemPrompt(),n=this.buildUserPrompt(e,t,r,s);try{const c=await this.callLLM(a,n);return this.extractDraftFromResponse(c)}catch(c){throw console.error("LLM generation error:",c),c}}buildSystemPrompt(){return`You are a helpful support assistant drafting replies for Jeep Beach emails.
STRICT RULES:
- Use ONLY information grounded in the provided JeepBeach snippets.
- If the answer isn't present, use the provided fallback pattern.
- Keep the reply concise (2â€“4 sentences), friendly, and helpful.
- Do not invent dates, prices, policies, or guarantees.
- End with one human contact path: "If you need a hand, reply here."`}buildUserPrompt(e,t,r,s){return`Email to reply to:
---
${e}
---

JeepBeach site knowledge (snippets):
---
${t}
---

Tone: ${r}

Write a short reply grounded ONLY in the snippets above. If nothing relevant, use the fallback pattern:
"${s}"
Return only the email body, no greetings/headers unless the email clearly expects it.`}async callLLM(e,t){var a;const r=this.buildRequestBody(e,t),s=await fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok){const n=await s.json().catch(()=>({}));throw new Error(`LLM API error: ${s.status} - ${((a=n.error)==null?void 0:a.message)||s.statusText}`)}return await s.json()}buildRequestBody(e,t){switch(this.provider){case"openai":return{model:"gpt-4o-mini",messages:[{role:"system",content:e},{role:"user",content:t}],max_tokens:250,temperature:.5};case"anthropic":return{model:"claude-3-haiku-20240307",max_tokens:250,temperature:.5,system:e,messages:[{role:"user",content:t}]};default:return{model:"gpt-4o-mini",messages:[{role:"system",content:e},{role:"user",content:t}],max_tokens:250,temperature:.5}}}extractDraftFromResponse(e){var s;if(!e||!e.choices||e.choices.length===0)throw new Error("Invalid LLM response");const t=e.choices[0],r=((s=t.message)==null?void 0:s.content)||t.text||"";if(!r.trim())throw new Error("Empty response from LLM");return r.trim()}async testConnection(){if(!this.apiKey)throw new Error("API key not configured");try{const t=await this.callLLM("You are a helpful assistant.",'Say "Hello, this is a test."');return this.extractDraftFromResponse(t)}catch(e){throw new Error(`LLM test failed: ${e.message}`)}}async getAvailableModels(){if(!this.apiKey)throw new Error("API key not configured");try{const e=await fetch(`${this.baseUrl}/models`,{headers:{Authorization:`Bearer ${this.apiKey}`}});if(!e.ok)throw new Error(`Models API error: ${e.status}`);return(await e.json()).data||[]}catch(e){return console.error("Error fetching models:",e),[]}}};typeof o<"u"&&o.exports?o.exports=u:window.LLMProvider=u;class d{constructor(){this.storage=new StorageManager,this.llmProvider=null,this.init()}async init(){await this.loadSettings(),this.setupEventListeners()}async loadSettings(){try{const e=await this.storage.getSyncData();document.getElementById("apiKey").value=e.apiKey||"",document.getElementById("provider").value=e.provider||"openai",document.getElementById("tone").value=e.tone||"",document.getElementById("fallbackMessage").value=e.fallbackMessage||"",document.getElementById("jeepBeachUrls").value=e.jeepBeachUrls||"",document.getElementById("useGmailApi").checked=e.useGmailApi||!1}catch(e){console.error("Error loading settings:",e),this.showStatus("Error loading settings","error")}}setupEventListeners(){document.getElementById("saveSettings").addEventListener("click",()=>{this.saveSettings()}),document.getElementById("testLLM").addEventListener("click",()=>{this.testLLM()}),document.getElementById("refreshCache").addEventListener("click",()=>{this.refreshCache()}),document.getElementById("resetDefaults").addEventListener("click",()=>{this.resetDefaults()}),document.querySelectorAll("input, textarea, select").forEach(t=>{t.addEventListener("change",()=>{this.saveSettings()})})}async saveSettings(){try{const e={apiKey:document.getElementById("apiKey").value.trim(),provider:document.getElementById("provider").value,tone:document.getElementById("tone").value.trim(),fallbackMessage:document.getElementById("fallbackMessage").value.trim(),jeepBeachUrls:document.getElementById("jeepBeachUrls").value.trim(),useGmailApi:document.getElementById("useGmailApi").checked};if(!e.apiKey){this.showStatus("API key is required","error");return}if(!e.tone){this.showStatus("Tone is required","error");return}if(!e.fallbackMessage){this.showStatus("Fallback message is required","error");return}if(!e.jeepBeachUrls){this.showStatus("JeepBeach URLs are required","error");return}await this.storage.setSyncData(e),this.showStatus("Settings saved successfully!","success")}catch(e){console.error("Error saving settings:",e),this.showStatus("Error saving settings: "+e.message,"error")}}async testLLM(){const e=document.getElementById("testLLM"),t=e.textContent;try{e.disabled=!0,e.textContent="Testing...";const r=await this.storage.getSyncData();if(!r.apiKey)throw new Error("API key not configured");this.llmProvider=new LLMProvider(r.apiKey,r.provider);const s=await this.llmProvider.testConnection();this.showStatus(`LLM test successful! Response: "${s}"`,"success")}catch(r){console.error("LLM test error:",r),this.showStatus("LLM test failed: "+r.message,"error")}finally{e.disabled=!1,e.textContent=t}}async refreshCache(){const e=document.getElementById("refreshCache"),t=e.textContent;try{if(e.disabled=!0,e.textContent="Refreshing...",!(await this.storage.getSyncData()).jeepBeachUrls)throw new Error("JeepBeach URLs not configured");const s=await this.sendMessageToBackground({type:"JB_REFRESH_SITE_CACHE"});if(s.error)throw new Error(s.error);this.showStatus("Site cache refreshed successfully!","success")}catch(r){console.error("Cache refresh error:",r),this.showStatus("Cache refresh failed: "+r.message,"error")}finally{e.disabled=!1,e.textContent=t}}async resetDefaults(){if(confirm("Are you sure you want to reset all settings to defaults? This will clear your current configuration."))try{const e=this.storage.getDefaultSettings();document.getElementById("apiKey").value=e.apiKey,document.getElementById("provider").value="openai",document.getElementById("tone").value=e.tone,document.getElementById("fallbackMessage").value=e.fallbackMessage,document.getElementById("jeepBeachUrls").value=e.jeepBeachUrls,document.getElementById("useGmailApi").checked=e.useGmailApi,await this.storage.setSyncData(e),this.showStatus("Settings reset to defaults!","success")}catch(e){console.error("Error resetting settings:",e),this.showStatus("Error resetting settings: "+e.message,"error")}}showStatus(e,t){const r=document.getElementById("status");r.textContent=e,r.className=`status ${t}`,r.style.display="block",setTimeout(()=>{r.style.display="none"},5e3)}sendMessageToBackground(e){return new Promise(t=>{chrome.runtime.sendMessage(e,r=>{chrome.runtime.lastError?t({error:chrome.runtime.lastError.message}):t(r||{})})})}}document.addEventListener("DOMContentLoaded",()=>{new d})});export default p();
